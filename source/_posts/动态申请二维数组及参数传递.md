---
title: 动态申请二维数组及参数传递
date: 2013-09-15 21:19
tags:
- C++
categories:
- C++
---


这两天在写一个小程序需要读入24位bmp图像。读入的图像信息要存储在二维矩阵中。
<!--more-->


一开始，我定义了这样的二维数组的。
```
Bmpoint img[height][width];//Bmpoint是自定义的像素点类
```

后来我发现，读入尺寸较小的bmp没有问题，可是当bmp尺寸较大时，程序就会异常停止。

单步调试到这一句，会提示 “底层因为接收到操作系统的信号而停止”。

![error](error.jpg)

网上搜一下，有人这样解释：物理上，把整个数组放在栈中是不合理的，因为栈的大小是一定且有限的。如果把传送给函数的整个数组放在栈中(内存大块复制)，则很快会把栈空间用光。

又是一番搜索与尝试，看到了这里的讨论：[动态申请二维数组空间](http://bbs.bccn.net/thread-204205-1-1.html)。

那么我的代码是这样的：
```
Bmpoint** img;//指针数组  
Bmpoint* array;//二维数组  
img = (Bmpoint**)malloc(sizeof(Bmpoint*)*infoHeader.biHeight);  
array = (Bmpoint*)malloc(sizeof(Bmpoint)*infoHeader.biHeight*infoHeader.biWidth);  
for(LONG i=0;i<infoHeader.biHeight;i++)  
{  
    img[i] = &array[i*infoHeader.biWidth];  
} 
```

这样也很容易把这个二维数组作为参数传递给其他函数。

只要把Bmpoint** img作为参数传递，就可以用img[i][j]这样的方式很容易的引用它了。